---
title: "Report BI 2021/2022 - Grupo 1"
date: "`r Sys.Date()`"
author: 20191393, 20190048, 20181339
output:
  rmdformats::robobook:
    code_folding: show
    toc: 3
    thumbnails: false
    lightbox: true
    gallery: false
    cache: false
    highlight: kate
---

```{r config, include=FALSE}
# bibliotecas --- modificar sempre que acrescentar uma biblioteca
bibliotecas <- c("knitr", "rmdformats", "readxl", "lubridate", "ggplot2", "DT")
for (bibl in bibliotecas) {
    if (bibl %in% rownames(installed.packages()) == FALSE){
        install.packages(bibl, dependencies = TRUE)
        library(bibl, character.only = TRUE)    
    }
     else {
        library(bibl, character.only = TRUE)
     }
}
rm(bibl, bibliotecas)

# knit: opções globais --- não modificar!
options(max.print="80")
opts_chunk$set(echo=FALSE,
	           cache=FALSE,
               prompt=FALSE,
               tidy=TRUE,
               comment=NA,
               message=FALSE,
               warning=TRUE)
opts_knit$set(width=80)
```

## Autores

-   Turma: T62
-   Grupo: G01/T62
-   Autores
    -   20191393 Ana Catarina Quintans - General Manager
    -   20190048 Carlos Chantre - Tech Lead
    -   20181339 Pedro Amaral - Market Analyst

## Introdução

	Vivemos em um mundo exponencialmente mais digital e com a digitalização das empresas e da sua informação, a necessidade de análise e tratamento desses mesmos dados é crescente e de imensurável importância na medida em que estes dados podem providenciar imenso valor e vantagens competitivas. 

	No âmbito da disciplina de Business Intelligence, foi elaborado este trabalho onde o grupo se propõe a estudar um data mart de uma empresa fictícia com dados sobre os seus produtos, vendas, clientes e lojas como forma de extrair a informação relevante para cada um dos  diversos departamentos desta empresa, nomeadamente, os departamentos financeiro, de marketing e de gestão da empresa, agregando valor aos dados utilizados através da análise de dados com  utilização da linguagem ... (to be continued)


## Marketing


### Perfil dos clientes

Apresentam-se algumas características dos clientes 
```{r}
load("sales_av.Rda")
## TODO FALTA TERMINAR
## Média de idades de clientes / territorio
clients_df <- aggregate(SalesAmount ~ CustomerKey + Region, data = sales_av,
                        FUN = sum, na.rm = TRUE) 


# ordered
clients_df <- clients_df[order(clients_df$SalesAmount, decreasing = TRUE),] 

# top 20 clients
clients_df_top20 <- head(clients_df, 50)
```


-   **Rendimento**


-   **Género**

```{r G1, eval = TRUE, echo = TRUE}
load("customers.Rda")
plot(as.factor(customers$MaritalStatus))
```

-   **Recomendações**



# Propostas para análise
## Departamento de Marketing
### Clientes
#### Qual o perfil do nosso cliente mais rentável? E do menos rentável?
#### Que variáveis dos clientes interferem positivamente no consumo das nossas bicicletas?

### Produto
#### O que é que se vende mais? De que categoria? De que subcategoria?

Nesta análise propõe-se avaliar as vendas da empresa numa abordagem *"general to detailed"* , de forma a que se desenhe uma perspetiva geral do desempenho, seguido de um estudo mais aprofundando, envolvendo as subcategorias das categorias principais. A análise terá foco tanto em quantidades
como em valores monetários.

### Por Categoria X Quantidades
```{r}
load("sales_product.Rda")
plot(as.factor(sales_product$Category))
```

### Por Faturação

```{r}
load("sales_av.Rda")
accs_sales_amount <- aggregate(SalesAmount ~ Category + salesYear, data = sales_av, 
                                FUN = sum, na.rm = TRUE)

sales_amt_bar <- 
    ggplot(accs_sales_amount, aes(fill = Category, x = salesYear, y = SalesAmount/10^6)) +
    geom_bar(position = "fill", stat = "identity") +
    labs(title = "Sales Amount by Categories",
         subtitle = " Years: 2016 to 2019",
         x = "Categories",
         y = "Percentages of Sales") +
    scale_y_continuous(labels = scales::percent) 

sales_amt_bar
```

As categorias mais vendidas ao longo do período de 2016 - 2019, consistem na categoria bicicletas. Em 2018, começou-se a vender outras categorias de produtos, nomeadamente, roupas e acessórios. Ambas as categorias, apesar de ainda serem pouco transacionáveis, cresceram.





### Por Subcategorias mais vendidas


```{r}
##subs_sales_amount <- aggregate(SalesAmount ~ SubCategory + salesYear,
##                             data = sales_av, FUN = sum, na.rm = TRUE)

##subs_most_sales <- subs_sales_amount |> arrange(desc(SalesAmount)) |> head(5)


```



#### Os novos produtos estão a vender mais ou menos que os anteriores?

### Região
#### Onde é que se vendeu mais?
#### Em que alturas é que se vende mais? Existe sazonalidade?

## Departamento de Vendas
### Análise de vendas por quarter e por ano
```{r}
sales_quarters_years <- aggregate(SalesAmount ~ salesQuarter + salesYear, 
                                  data = sales_av, FUN = sum, na.rm = TRUE)

salesAmount_quarter_year <- ggplot(sales_quarters_years, aes(x = factor(salesQuarter), y = SalesAmount/10^6)) +
    geom_col(fill = "lightblue") + 
    facet_wrap(~ salesYear, nrow = 4) +
    labs(title = "Sales Amount by Quarters",
         subtitle = " Years: 2016 to 2019",
         x = "Quarters",
         y = "Sales Amount")

salesAmount_quarter_year

```

Não existem dados de transações relativos aos 2 primeiros quarters de 2016 e os dois últimos de 2019.
Existem flutuações entre quarters, sendo a tendência do volume de vendas de crescimento. É notável que o período entre o Q3- 2016 e o Q2- 2017, foi marcado por um crescimento, enquanto que no mesmo período dos anos seguintes (Q3- 2017 a Q2-2018), sofreu um decréscimo do volume de vendas. Esta tendência inverteu-se no período seguinte, sendo registado um crescimento.
Acreditamos que, poderá existir um padrão de sazonalidade, que caso se repita, se refletirá num decréscimo do volume de vendas no próximo ano. Deverá existir um controlo mais rigoroso do volume de vendas para que este padrão possa ser identificado antecipadamente.


### Por frequência de vendas de modo a saber períodos de tempo em que houve
mais ativididade

```{r}
sales_period <- aggregate(SalesAmount ~ salesMonth + salesYear + salesMonthday, 
                      data = sales_av, FUN = mean, na.rm = TRUE)

month_ord <- c("Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug",
               "Sep", "Oct", "Nov", "Dec")

sales_period$salesMonth <- ordered(sales_period$salesMonth, levels = month_ord)



sales_period_bar <- ggplot(sales_period, aes(x = as.integer(salesMonthday), 
                                  y = SalesAmount/1000)) + 
                                        geom_line (color = "lightblue") +
                                        geom_hline(yintercept = 1.5, 
                                                  linetype = "dashed",
                                                  color = "red",
                                                  size = 0.2) +
                                        geom_point(size = 0.3) + 
                                        scale_x_continuous(breaks = c(1, 7, 15, 22, 31)) + 
                                        facet_grid(salesMonth ~ salesYear) + 
                                        labs(title = "Average Daily Sales", 
                                             subtitle = "Years: 2016 to 2019", 
                                             x = "Weekdays", 
                                             y = "Sales Amount(thousand dollars)") +
                                        theme_light()

sales_period_bar
```
O presente gráfico permite perceber as venda diárias em quatro dimensões temporais: vendas diárias, semanais, mensais e anuais.
A linha vermelha representa o mínimo que a empresa necessita de vender por mês para se tornar rentável (1.500 doláres). 




## Departamento Financeiro
### Produto
#### Saber quais são os produtos com maior rentabilidade?

# Apêndice

## Dicionário do __Data Mart__

## 1.`calendar` 

Informação de calendário.
 
 + **ID**: Constitui-se como a Surrogate Key (chave artificial).
 + **Date**: Contempla as datas ( dia, mês e ano) em que se realizaram transações (_date_)
 + **DayNumberOfWeek**:Identifica numericamente o dia da semana. (_numeric_)
 + **DayName**: Identifica textualmente o dia da semana. (_string_)
 + **MonthName**: Identifica textualmente o mês.(_string_)
 + **MonthNumberOfYear**: Identifica o mês numericamente.(_numeric_)
 + **DayNumberOfYear**: Identifica o dia do ano num formato de 365 dias. (_numeric_)
 + **WeekNumberOfYear**: Identifica a semana numericamente.(_numeric_)
 + **CalendarQuarter**: Refere o trimestre em que se realizou a transação. (_numeric_)
 + **CalendarYear**: Refere o ano.(_numeric_)
 + **DayNumberOfMonth**: Identifica o dia do mês.(_numeric_)
 
## 2.`product`

Informação sobre o produto.
 
 + **ProductKey**: Chave que identifica o produto (_factor_).
 + **ProductSubCategoryKey**: Chave que identifica a sub-categoria do produto (_factor_).
 + **ProductName**: Nome do produto.(_string_)
 + **StandarCost**: Custo de fabrico. (_numeric_)
 + **Color**: Cor do produto. (_string_)
 + **SafetyStockLevel**: Stock mínimo.(_numeric_)
 + **ListPrice**: Preço de venda dos produtos. (_numeric_)
 + **Size**: Tamanho do produto.(_numeric_)
 + **DaysToManufacture**: Dias para produzir.(_numeric_)
 + **DealerPrice**: Preço de venda para revendedores.(_numeric_)
 + **Class**: Classe de produto.(_string_)
 + **ModelName**: Nome do modelo do produto.(_string_)
 + **Description**: Descrição do produto. (_string_)
 + **Status**: Disponibilidade para vender.(_string_)
 + **SubCategory**: Sub-categoria. (_string_)
 + **Category**: Categoria. (_string_)
 + **StartDate**: Desde quando o produto está disponível para vender.(_date_)
 + **EndDate**: Desde quando o produto deixou de estar disponivel para venda. (_date_)
 
## 3.`productCategory`

Informação sobre a categoria do produto.

 + **ProductCategoryKey**: Chave que identifica univocamente o produto. (_factor_)
 + **EnglishProductCategoryName**: Nome da categoria do produto em Inglês.(_string_)
 + **SpanishProductCategoryName**: Nome da categoria do produto em Espanhol.(_string_)
 + **FrenchProductCategoryName**: Nome da categoria do produto em Francês.(_string_)

## 4.`productSubCategory`

Informação sobre a sub-categoria do produto.

 + **ProductCategoryKey**: Chave que identifica univocamente o produto. (_factor_)
 + **ProductSubCategoryKey**: Chave que identifica a sub-categoria do produto (_factor_).
 + **EnglishProductSubCategoryName**: Nome da sub-categoria do produto em Inglês.(_string_)
 + **SpanishProductSubCategoryName**: Nome da sub-categoria do produto em Espanhol.(string_)
 + **FrenchProductSubCategoryName**: Nome da sub-categoria do produto em Francês. (_string_)
 
## 5.`customers`

Informação sobre os clientes.

 + **CustomerKey**: Chave que identifica o cliente.(_factor_)
 + **GeographyKey**: Chave que identifica a cidade/código-postal do cliente.(_factor_)
 + **Name**: Nome do cliente.(_string_)
 + **BirthDate**: Data de nascimento do cliente.(_date_)
 + **MaritalStatus**: Estado-civil do cliente.(_string_)
 + **Gender**: Género do Cliente. (_string_)
 + **YearlyIncome**: Nível de rendimento do cliente.(_numeric_)
 + **NumberChildrenAtHome**: Número de crianças do cliente.(_numeric_)
 + **Occupation**: Profissão do cliente.(_string_)
 + **HouseOwnerFlag**: Se o cliente é proprietário ou não de habitação. (_numeric_)
 + **NumberCarsOwned**: Quantos carros cliente possui.(_numeric_)
 + **AddressLine**: Morada do cliente. (_string_)
 + **Phone**: Número de telefone do cliente. (_numeric_)
 + **DateFirstPurchase**: Data da primeira compra. (_date_)
 
## 6.`territory`

Informação geográfica.

 
 + **Territory Key**: Chave que identifica o território. (_factor_)
 + **Region**: Região. (_string_)
 + **Country**: País. (_string_)
 + **Group**: Região económica. (_string_)
  
## 7.`factsales`

Tabela de factos [Vendas]

 + **OrderDateKey**: Chave que identifica a data da compra.(_factor_)
 + **ProductKey**: Chave que identifica o produto (_factor_).
 + **CustomerKey**: Chave que identifica o cliente.(_factor_)
 + **SalesTerritoryKey**: Chave que identifica o território onde se realizou a compra.(_factor_)
 + **SalesOrderNumber**: Número que identifica a venda.(_numeric_)
 + **SalesOrderLineNumber**: Número que identifica as transações numa venda. (_string_)
 + **OrderQuantity**: Quantidade transacionada. (_numeric_)
 + **UnitPrice**: Preço unitário. (_numeric_)
 + **ProductStandardCost**: O custo do produto para a empresa. (_numeric_)
 + **SalesAmount**: Preço da transação.(_numeric_)
 + **TaxAmt**: Imposto sobre a venda. (_numeric_)
 + **Freight**: Custo de envio. (_numeric_)
 + **RegionMonthID**: Informação sobre quando (mês) foi realizada a venda e em que região. (_factor_)